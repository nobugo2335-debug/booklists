// prisma/schema.prisma
// 複数の本棚（市町村）と本のデータを管理するスキーマ

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Neon DB接続のための環境変数を使用
  url      = env("DATABASE_URL")
}

// 本棚（市町村の場所など）を管理するモデル
model BookShelf {
  id        String   @id @default(cuid())
  // 本棚を識別する管理ID（QRコードなどで使用）
  shelfId   String   @unique
  // 本棚の設置場所名（例: "世田谷区役所", "福岡市中央図書館"）
  location  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // この本棚に登録されている本
  books     Book[]
}

// 本のデータを管理するモデル
model Book {
  id           String    @id @default(cuid())
  // 紐づく本棚ID
  shelfId      String
  // タイトル (必須)
  title        String
  // 著者
  author       String?
  // 内容
  description  String?
  // ステータス: "available" (利用可能/〇) または "on_loan" (貸出中)
  status       String    @default("available") 
  // 管理者ID（自動入力、誰が追加したかの記録用）
  adminId      String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  // リレーション
  bookShelf    BookShelf @relation(fields: [shelfId], references: [shelfId])

  // インデックス: 検索とリスト表示の最適化
  @@index([shelfId, title])
  @@index([status])
}